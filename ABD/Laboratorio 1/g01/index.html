
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Transact-SQL / T-SQL</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="g01"
                  title="Transact-SQL / T-SQL"
                  environment="web"
                  feedback-link="mailto:e">
    
      <google-codelab-step label="Introduccion a T-SQL" duration="0">
        <p>Transact-SQL, o como se suele abreviar, T-SQL, es un lenguaje de programacion diseñado para ser usado en el motor de bases de datos de microsoft SQL Server. Al ser considerado un lenguaje de programacion, este le da multiples herramientas similares a las de otros lenguajes de programacion. En esta guia se espera que el estudiante:</p>
<ul>
<li>Uso de Sub-consultas para consultas de alta complejidad</li>
<li>Uso de bloques de programacion para el uso de variables y programacion dinamica</li>
<li>Uso de funciones y procedimientos almacenados para la estandarizacion de tareas</li>
<li>Uso de vistas para la reutilizacion de consultas comunes</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Sub-consultas" duration="0">
        <p>Las sub-consultas son consultas anidadas dentro de otras consultas productos de procesos:</p>
<ul>
<li>INSERT</li>
<li>UPDATE</li>
<li>DELETE</li>
<li>SELECT</li>
</ul>
<p>Las sub-consultas son regularmente utilizadas para la generacion de consultas dinamicas, es decir, consultas que, con el tiempo, pueden necesitar cambios, cambios que se actualizan gracias al uso de subconsultas, como el siguiente ejemplo:</p>
<ul>
<li>Consulta sin usar sub-consultas, donde actualizamos una lista de empleados que cumplen cierta condicion</li>
</ul>
<pre><code language="language-sql" class="language-sql">UPDATE EMPLEADO SET Estrella = 1 WHERE id = 17 OR id = 3 OR id = 20 OR id = 1
</code></pre>
<ul>
<li>Consulta usando sub-consultas, donde las condiciones ahora son dinamicas y se actualizan a aquellos que cumplen la misma</li>
</ul>
<pre><code language="language-sql" class="language-sql">UPDATE EMPLEADO SET Estrella = 1 WHERE id IN 
(SELECT E.id FROM Empleado E
INNER JOIN Proyecto P ON E.id = P.id_lider
GROUP BY E.id, E.nombre
HAVING SUM(P.Precio) &gt; 700)
</code></pre>
<p>Algunos utilidades de las sub-consultas son las siguientes:</p>
<ol type="1">
<li>Podemos usar SubQueries como que de una lista se tratasen, o un valor unico, para usarlas dentro de condionales</li>
<li>Podemos usarlas como fuentes de datos dentro de otras consultas para usar los resultados de la SubQuery como una tabla</li>
<li>Casos donde se necesiten dato/s de forma dinamica para sentencias de SELECT, UPDATE, INSERT y DELETE son problemas que se resuelve con SubQueries</li>
</ol>
<p>Si el estudiante desea saber mas sobre sub-consultas, puede revisar <a href="https://chriss6202.github.io/Codelabs/g05/g05/#0" target="_blank">la siguiente guia de trabajo</a></p>


      </google-codelab-step>
    
      <google-codelab-step label="Tipos de datos" duration="0">
        <p>Hay que tener en cuenta los tipos de datos que usaremos para cada campo, así que se listaran los más utilizados para tener algunas nociones:</p>
<p>Numericos:</p>
<p class="image-container"><img alt="Datos numericos" src="img\\681683940dc41940.png"></p>
<p>Cadenas de texto:</p>
<p class="image-container"><img alt="Cadenas de texto" src="img\\2ee36749bbd11b52.png"></p>
<p>Fecha:</p>
<p class="image-container"><img alt="Fecha" src="img\\42247cac53366c21.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Bloque anonimo" duration="0">
        <p>Los bloques anónimos no tienen ningún nombre concreto, por eso de anónimos. Un bloque T-SQL es definido por las palabras clave DECLARE, BEGIN, EXCEPTION, y END, que dividen el bloque en tres secciones:</p>
<ul>
<li>Declare: Se definen los distintos objetos que se van a utilizar en el bloque (variables, constantes, cursores, etcétera). Esta sección es opcional.</li>
<li>Begin: En esta zona estará el código T-SQL que ejecutaremos.</li>
<li>End: Indica el cierre del bloque anónimo.</li>
</ul>
<p>Un bloque es en sí mismo una sentencia ejecutable, por lo que se pueden anidar los bloques unos dentro de otros.</p>
<p>Sintaxis:</p>
<pre><code language="language-sql" class="language-sql">DECLARE
    --Declaracion de variables
BEGIN
    --Tratamiento de excepciones
END;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Variables en T-SQL" duration="0">
        <p>Variables: Las variables son nombres para procesar los elementos de los datos.</p>
<pre><code language="language-sql" class="language-sql">Nombre_variable tipo [NOT NULL] [:= valor | DEFAULT valor]
</code></pre>
<p>Al tener una tabla origen, podemos insertar los datos de dicha tabla a una nueva tabla destino. Se puede elegir ciertos campos de la tabla o bien se pueden insertar todos, teniendo en cuenta que ambas tienen que tener los mismos capos con su mismo tipo de dato.</p>
<pre><code language="language-sql" class="language-sql">INSERT INTO nombre_tabla SELECT * FROM nombre_tabla_fuente
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Estructuras de control" duration="0">
        <h2 is-upgraded>IF/THEN/ELSE</h2>
<p>Esta sentencia es utilizada cuando se quiere elegir entre dos opciones basadas en una condición.</p>
<pre><code language="language-sql" class="language-sql">IF condition THEN
    {-- Código a ejecutar si la condición es verdadera... }

ELSE
    {-- Código a ejecutar si la condición es false... }
END IF;
</code></pre>
<h2 is-upgraded>WHILE</h2>
<p>La instruccion WHILE, igual que sus homologos en otro lenguaje de programacion, permite entrar en bucles mientras se cumpla en una condicion</p>
<pre><code language="language-sql" class="language-sql">BEGIN
    DECLARE @a INT = 0, @b INT = 1, @tmp INT, @i INT = 1;
    WHILE @i &lt; 10
    BEGIN
	    SELECT @tmp = @b, @b = @a + @b, @a = @tmp, @i = @i +1;
	    PRINT &#39;b = &#39; + CAST(@b AS VARCHAR);
    END
END
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Funciones y procedimientos almacenados" duration="0">
        <h2 is-upgraded>Procedimientos almacenados</h2>
<p>Un procedimiento almacenado, o stored procedure en inglés, es un conjunto de sentencias SQL, al cual se le asigna un nombre y se almacena como un objeto en el servidor de la base de datos, de manera que este pueda ser reutilizado y compartido con diferentes programas.</p>
<p>Al ejecutar un procedimiento por primera vez, SQL Server crea un plan de ejecución y lo guarda en el plan cache, de forma que en ejecuciones futuras se pueda reutilizar dicho plan y el procedimiento se realice muy rápido con rendimiento confiable.</p>
<p>Sintaxis:</p>
<pre><code language="language-sql" class="language-sql">CREATE [OR ALTER] PROCEDURE nombre_procedimiento
[
@aram1 datatype [, ...n]
]
AS
BEGIN
    sentencia_sql;
    [...n]
END
</code></pre>
<h2 is-upgraded>Funciones</h2>
<p>De forma similar a los procedimientos almacenados, las funciones son conjuntos de sentencias SQL que se almacenan como objetos en la base de datos que suelen encapsular procesos lógicos para su reutilización.</p>
<p>Sin embargo, la principal diferencia con los procedimientos almacenados es que es obligatorio que las funciones devuelvan un valor, al contrario de los procedimientos que pueden o no tener valores de retorno. Otras diferencias entre procedimientos y funciones son:</p>
<ul>
<li>Las funciones pueden tener sólo parámetros de entrada, mientras que los procedimientos pueden tener de entrada y salida.</li>
<li>Las funciones pueden ser llamadas desde un procedimiento, pero no se puede llamar un procedimiento desde una función.</li>
<li>Las funciones escalares pueden usarse como campo en una consulta.</li>
<li>Sólo se permiten instrucciones de consulta, no es posible insertar, actualizar o eliminar datos de tablas.</li>
</ul>
<h3 is-upgraded>Funciones Escalares</h3>
<p>Las funciones escalares reciben varios parámetros y devuelven un único valor. Sintaxis:</p>
<pre><code language="language-sql" class="language-sql">CREATE [OR ALTER] FUNCTION dbo.[nombre_funcion] (
    @param1 datatype [, ...n]
)
RETURNS datatype
AS
BEGIN
    [sentencias sql]
    [... n]
    RETURN @varable_de_retorno
END
</code></pre>
<h3 is-upgraded>Funciones de Tabla</h3>
<p>Este tipo de funciones brinda como valor de retorno una tabla generada dentro de la misma. Estas brindan la posibilidad de incluir estructuras de control como IF o WHILE. Pueden ser utilizadas en el FROM de una consulta y también en las sentencias JOIN.</p>
<p>Para ejemplo, se puede recrear el ejemplo hecho en la parte de Procedimientos, pero ahora como una función que devuelve una tabla.</p>
<pre><code language="language-sql" class="language-sql">CREATE FUNCTION lista()
RETURNS table
AS
    RETURN
    SELECT l.titulo Libro, p.fecha_prestamo &#39;Fecha de préstamo&#39;, p.fecha_devolucion &#39;Fecha de devolución&#39;, CONCAT(u.nombre, &#39; &#39;, u.apellido) AS Cliente
    FROM PRESTAMO AS p
    INNER JOIN USUARIO AS u ON p.codigo_usuario = u.codigo
    INNER JOIN EJEMPLAR AS e ON e.codigo = p.codigo_ejemplar
    INNER JOIN LIBRO AS l ON l.codigo = e.codigo_libro;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Trigger" duration="0">
        <p>Un Trigger se lleva a cabo cuando se produce algún suceso relacionado con la misma. Los triggers pueden utilizarse para completar la integridad referencial, también para imponer reglas de negocio complejas o para auditar cambios en los datos. El código contenido en un trigger denominado cuerpo del trigger, está formado por bloques T-SQL.</p>
<pre><code language="language-sql" class="language-sql">CREATE [ OR ALTER ] TRIGGER trigger_name
ON { table } {AFTER | INSTEAD OF}
{INSERT | UPDATE | DELETE}
AS
BEGIN
    --Cuerpo del trigger
END
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Créditos" duration="0">
        <p>Departamento de Electrónica e Informática, Universidad Centroamericana José Simeón Cañas, La Libertad, El Salvador.</p>
<p><strong>Versión de este documento:</strong> Versión 5, 2025.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><strong>Versión</strong></p>
</td><td colspan="1" rowspan="1"><p><strong>Autores</strong></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>1</strong></p>
</td><td colspan="1" rowspan="1"><p>Ismael Chicas Garcia (00036818@uca.edu.sv), Oscar Rivas Borjas (00005218@uca.edu.sv), Erick Varela Guzmán (evarela@uca.edu.sv).</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>2</strong></p>
</td><td colspan="1" rowspan="1"><p>Josué Cortez (00402918@uca.edu.sv)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>3</strong></p>
</td><td colspan="1" rowspan="1"><p>Alejandro Ernesto Cerón Lemus (00040116@uca.edu.sv), Brian Darwin Carranza Campos (00136020@uca.edu.sv)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>4</strong></p>
</td><td colspan="1" rowspan="1"><p>Claudia María Chávez Grande (00037221@uca.edu.sv)</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p><strong>5</strong></p>
</td><td colspan="1" rowspan="1"><p>Christian Alejandro Paz Escobar (00132720@uca.edu.sv)</p>
</td></tr>
</table>
<p><img alt="license" src="img\\2d61b47ed7775e46.jpg"> This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
