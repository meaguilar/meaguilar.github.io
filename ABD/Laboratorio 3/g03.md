author: Erick Varela
summary: "Guía de aprendizaje 03"
id: g03
categories: Databases
environments: SQLServer
status: Published
feedback link: mailto:evarela@uca.edu.sv


# Índices y Secuencias en SQL Server

## Objetivos del laboratorio

- Comprender qué son los índices y cómo mejoran el rendimiento de las consultas.
- Crear, inspeccionar y eliminar distintos tipos de índices (`CLUSTERED`, `NONCLUSTERED`, `UNIQUE`, `COMPOSITE`, `INCLUDE`).
- Entender qué es una secuencia (`SEQUENCE`) y cómo se utiliza para generar valores numéricos automáticos.

---

## ¿Qué es un índice en SQL Server?

Un **índice** es una estructura de datos auxiliar (normalmente un **árbol B-Tree**) que SQL Server usa para acceder más rápido a los registros de una tabla o vista.  
Funciona como el índice de un libro: en lugar de revisar todas las páginas, el motor usa el índice para saltar directamente al registro deseado.

<aside class="positive">
Los índices son fundamentales para optimizar consultas con grandes volúmenes de datos.
</aside>

### Ventajas
- Mejora drásticamente la velocidad de las consultas con `WHERE`, `JOIN`, `ORDER BY` y `GROUP BY`.
- Reduce el tiempo de búsqueda en tablas grandes.
- Permite mantener la unicidad de valores si se define como `UNIQUE`.

### Desventajas
- Ocupan espacio adicional en disco.
- Pueden ralentizar operaciones de escritura (`INSERT`, `UPDATE`, `DELETE`) porque el índice también debe actualizarse.

---

## Tipos de índices en SQL Server

### Índice Clustered (Agrupado)
El índice **clustered** determina el orden físico de los datos en la tabla.  
Cada tabla solo puede tener **un** índice clustered, ya que los datos se almacenan físicamente siguiendo ese orden.

> Por defecto, la **clave primaria PRIMARY KEY** crea un índice clustered automáticamente, a menos que se especifique lo contrario.

**Sintaxis:**
```sql
CREATE CLUSTERED INDEX IX_Empleados_Departamento ON Empleados(Departamento);
```

---

### Índice Nonclustered (No agrupado)
El índice **nonclustered** es una estructura separada que almacena una copia ordenada de las columnas indexadas y un puntero a las filas reales de la tabla.  
No cambia el orden físico de los datos.

**Sintaxis:**
```sql
CREATE NONCLUSTERED INDEX IX_Empleados_Salario ON Empleados(Salario);
```

---

### Índice Único (`UNIQUE`)
Garantiza que los valores de la(s) columna(s) sean únicos dentro de la tabla.  
Puede ser **CLUSTERED** o **NONCLUSTERED**.

**Sintaxis:**
```sql
CREATE UNIQUE INDEX IX_Empleados_Email ON Empleados(Email);
```

---

### Índice Compuesto
Usa más de una columna como clave del índice.  
SQL Server ordena primero por la primera columna y luego por las siguientes.

**Sintaxis:**
```sql
CREATE NONCLUSTERED INDEX IX_Ventas_Region_Fecha ON Ventas(Region, Fecha);
```

---

### Índice con columnas incluidas (`INCLUDE`)
Permite incluir columnas adicionales en el índice sin que formen parte de la clave de ordenación.  
Estas columnas se almacenan junto al índice y pueden **cubrir consultas** sin acceder a la tabla base.

**Sintaxis:**
```sql
CREATE NONCLUSTERED INDEX IX_Ventas_Region
ON Ventas(Region)
INCLUDE (Fecha, Monto);
```

<aside class="positive">
Los índices con columnas incluidas son ideales para consultas con múltiples columnas en `SELECT`, pero pocas en `WHERE`.
</aside>

---

## Administración de índices

- **Ver índices existentes:**
  ```sql
  EXEC sp_helpindex 'Empleados';
  ```

- **Eliminar un índice:**
  ```sql
  DROP INDEX IX_Empleados_Salario ON Empleados;
  ```

- **Verificar índices faltantes:**
  ```sql
  SELECT * FROM sys.dm_db_missing_index_details;
  ```

---

## ¿Qué es una Secuencia (`SEQUENCE`)?

Una **secuencia** es un objeto de base de datos que genera una serie numérica de valores en orden definido.  
Es independiente de cualquier tabla, a diferencia de `IDENTITY`, que pertenece a una columna específica.

**Sintaxis para crear una secuencia:**
```sql
CREATE SEQUENCE Seq_Facturas
    AS INT
    START WITH 1000
    INCREMENT BY 1;
```

**Usar una secuencia en una inserción:**
```sql
INSERT INTO Facturas (NumeroFactura, Cliente, Total)
VALUES (NEXT VALUE FOR Seq_Facturas, 'Juan Pérez', 350.75);
```

**Reiniciar una secuencia:**
```sql
ALTER SEQUENCE Seq_Facturas RESTART WITH 2000;
```

**Eliminar una secuencia:**
```sql
DROP SEQUENCE Seq_Facturas;
```

---

## Créditos

Departamento de Electrónica e Informática, Universidad Centroamericana José Simeón Cañas, La Libertad, El Salvador.

**Versión de este documento:** Versión 1.00, 2025.

| **Versión** | **Año** | **Autores** |
|--------------|----------|--------------|
| **1.00** | 2025 | Claudia Maria Chavez Grande, 00037221@uca.edu.sv|

![license](./license.jpg) This work is licensed under a [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License](http://creativecommons.org/licenses/by-nc-sa/4.0/).